<html>

<head>
    <title>UMA VR</title>
    <script src="https://aframe.io/releases/0.8.0/aframe.min.js"></script>
    <script>
        var umaPrograms = [
            {title:'Architecture'                           , video: 'http://distribution.bbb3d.renderfarming.net/video/mp4/bbb_sunflower_1080p_60fps_normal.mp4'},
            {title:'Art'                                    , link: '/' },
            {title:'Aviation'                               },
            {title:'Applied Science'                        },
            {title:'Biology'                                },
            {title:'Business Administration'                },
            {title:'Computer Information Systems'           },
            {title:'Dental Assisting'                       },
            {title:'Dental Hygiene'                         },
            {title:'English'                                },
            {title:'Financial Services'                     },
            {title:'Interdisciplinary Studies'              },
            {title:'Information and Library Services'       },
            {title:'Justice Studies'                        },
            {title:'Liberal Studies'                        },
            {title:'Mental Health and Human Services'       },
            {title:'Medical Laboratory Technology'          },
            {title:'Jazz and Contemporary Music'            },
            {title:'Nursing'                                },
            {title:'Public Administration'                  },
            {title:'Social Science'                         },
            {title:'Veterinary Technology'                  }
        ];

        function shuffle(array) {
            var currentIndex = array.length, temporaryValue, randomIndex;

            // While there remain elements to shuffle...
            while (0 !== currentIndex) {

                // Pick a remaining element...
                randomIndex = Math.floor(Math.random() * currentIndex);
                currentIndex -= 1;

                // And swap it with the current element.
                temporaryValue = array[currentIndex];
                array[currentIndex] = array[randomIndex];
                array[randomIndex] = temporaryValue;
            }

            return array;
        }

        var randomPrograms = shuffle(umaPrograms);

        AFRAME.registerComponent('uma-programs', {
            init: function () {
                // Solution for Creating Entities.
                var sceneEl = document.querySelector('a-scene');
                var assetsEl = document.querySelector('a-assets');

                var angFrac = 360 / randomPrograms.length;
                var ang = 0.00;
                var radius = 5.0;
                var up = new THREE.Vector3(0, 1, 0);

                for (var i = 0; i < randomPrograms.length; i++) {
                    var x = i, y = i, z = 1;
                    console.log(ang);

                    var pos = {
                        x: radius * Math.sin(THREE.Math.degToRad(ang)),
                        y: ((i % 2)*0.5),
                        z: radius * Math.cos(THREE.Math.degToRad(ang))
                    };

                    //alert(pos);

                    var rot = new THREE.Quaternion();
                    rot.setFromAxisAngle(up, ang);
                    //console.log(rot);

                    var vectorRot = new THREE.Vector3(
                        THREE.Math.degToRad(pos.x),
                        THREE.Math.degToRad(pos.y),
                        THREE.Math.degToRad(pos.z)
                    );
                    vectorRot.applyQuaternion(rot);
                    //console.log(vectorRot);

                    /*var stringRot = THREE.Math.radToDeg(vectorRot.x) + " " + 
                    THREE.Math.radToDeg(vectorRot.y) + " " + 
                    THREE.Math.radToDeg(vectorRot.z);*/
                    var rotAng = 0.00;

                    if (ang < 180) {
                        rotAng = -(180 - ang);
                    } else {
                        rotAng = ang - 180;
                    }

                    var stringRot = "0 " + rotAng.toFixed(0) + " 0";
                    console.log(stringRot);

                    var boxEl = document.createElement('a-box');
                    boxEl.setAttribute('position', pos);
                    boxEl.setAttribute('rotation', stringRot); // all show up with "-90 0 0"
                    boxEl.setAttribute('width', '2.6');
                    boxEl.setAttribute('height', '0.3');
                    boxEl.setAttribute('depth', '0.1');
                    boxEl.setAttribute('color', 'black');
                    boxEl.setAttribute('programArrayIndex', i);
                    //boxEl.setAttribute('opacity', '0.3');
                    sceneEl.appendChild(boxEl);

                    var textEl = document.createElement('a-entity');
                    textEl.setAttribute('text', 'color: white; align: center; width: 3; font: exo2semibold; value: ' + randomPrograms[i].title);
                    //textEl.setAttribute('position', pos);
                    //textEl.setAttribute('rotation', stringRot); // all show up with "-90 0 0"
                    textEl.setAttribute('position', '0 0 0.11');
                    boxEl.appendChild(textEl);

                    boxEl.addEventListener('click', function(e) {
                        e.currentTarget.setAttribute('color', '#333');
                        var i = e.currentTarget.getAttribute('programArrayIndex');

                        if ('video' in randomPrograms[i]) {
                            var videoDisplayPos = randomPrograms[i].pos;
                            //videoDisplayPos.x -= 2;
                            console.log(randomPrograms[i].video);
                            var videoDisplayEl = document.createElement('a-video');
                            //videoDisplayEl.setAttribute('src', '#' + randomPrograms[i].videoId);
                            videoDisplayEl.setAttribute('src', randomPrograms[i].video);
                            videoDisplayEl.setAttribute('width', '8');
                            videoDisplayEl.setAttribute('height', '4.5');
                            videoDisplayEl.setAttribute('position', videoDisplayPos);
                            videoDisplayEl.setAttribute('rotation', '0 ' + randomPrograms[i].rotAng + ' 0');
                            sceneEl.appendChild(videoDisplayEl);
                        } else if ('link' in randomPrograms[i]) {
                            document.location = randomPrograms[i].link;
                        }
                    });
                    boxEl.addEventListener('mouseenter', function(e) {
                        e.currentTarget.setAttribute('color', '#666');
                    });
                    boxEl.addEventListener('mouseleave', function(e) {
                        e.currentTarget.setAttribute('color', 'black');
                    });

                    /*textEl.addEventListener('trackpaddown', function(e) {
                        var text = e.target.getAttribute('text');
                        text.color = '#BBB';
                        e.target.setAttribute('text', text);
                    });
                    textEl.addEventListener('mouseenter', function(e) {
                        var text = e.target.getAttribute('text');
                        text.color = '#BBB';
                        e.target.setAttribute('text', text);
                    });
                    textEl.addEventListener('mouseleave', function(e) {
                        var text = e.target.getAttribute('text');
                        text.color = 'white';
                        e.target.setAttribute('text', text);
                    });*/

                    randomPrograms[i].element = boxEl;
                    randomPrograms[i].ang = ang;
                    randomPrograms[i].rotAng = rotAng;
                    randomPrograms[i].pos = pos;

                    /*if ('video' in randomPrograms[i]) {
                        randomPrograms[i].videoId = 'video' + i;

                        var videoEl = document.createElement('video');
                        videoEl.setAttribute('id', randomPrograms[i].videoId);
                        videoEl.setAttribute('loop', 'false');
                        videoEl.setAttribute('src', randomPrograms[i].video);
                        assetsEl.appendChild(videoEl);
                    }*/

                    ang += angFrac;
                }
            }
        });
    </script>
</head>

<body>
    <a-scene uma-programs>
        <a-assets>
            <img id="green" src="quad-backdrop-60percent.jpg">
            <!--<img id="groundTexture" src="https://cdn.aframe.io/a-painter/images/floor.jpg">-->
        </a-assets>
        <!--<a-box position="-1 0.5 -3" rotation="0 45 0" color="#4CC3D9"></a-box>
        <a-sphere position="0 1.25 -5" radius="1.25" color="#EF2D5E"></a-sphere>
        <a-cylinder position="1 0.75 -3" radius="0.5" height="1.5" color="#FFC65D"></a-cylinder>-->
        <a-sky src="#green" position="" rotation="" scale="" visible="" material="" geometry=""></a-sky>
        <!--<a-plane src="#groundTexture" rotation="-90 0 0" width="10" height="10" repeat="10 10"></a-plane>-->

        <a-text value="Welcome to UMA! Choose a program:" color="#BBB" position="-3 2 -3" scale="1.5 1.5 1.5"></a-text>

        <!-- Match Daydream controller if present, regardless of hand. -->
        <!--<a-entity daydream-controls></a-entity>-->
        <a-entity laser-controls></a-entity>
        
        <a-camera><a-cursor></a-cursor></a-camera>
    </a-scene>
</body>

</html>